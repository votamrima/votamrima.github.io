<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="4.2.1">Jekyll</generator><link href="http://localhost:4000/feed.xml" rel="self" type="application/atom+xml" /><link href="http://localhost:4000/" rel="alternate" type="text/html" /><updated>2023-11-10T18:37:05+01:00</updated><id>http://localhost:4000/feed.xml</id><title type="html">Some stories from iT lab</title><subtitle>.</subtitle><author><name>{&quot;name&quot;=&gt;nil, &quot;avatar&quot;=&gt;nil, &quot;bio&quot;=&gt;&quot;&quot;, &quot;location&quot;=&gt;nil, &quot;email&quot;=&gt;nil}</name></author><entry><title type="html">Creating a Local YUM Repository on Rocky Linux</title><link href="http://localhost:4000/creating-local-yum-repo/" rel="alternate" type="text/html" title="Creating a Local YUM Repository on Rocky Linux" /><published>2023-11-10T18:15:00+01:00</published><updated>2023-11-10T18:15:00+01:00</updated><id>http://localhost:4000/creating-local-yum-repo</id><content type="html" xml:base="http://localhost:4000/creating-local-yum-repo/">&lt;h1 id=&quot;creating-a-local-yum-repository-on-rocky-linux&quot;&gt;Creating a Local YUM Repository on Rocky Linux&lt;/h1&gt;

&lt;p&gt;Local YUM repositories are crucial for systems where internet access is limited, or package deployment needs tight control. This short article guides you through setting up a local repository on Rocky Linux.&lt;/p&gt;

&lt;h2 id=&quot;unpacking-rpm-file&quot;&gt;Unpacking RPM File&lt;/h2&gt;

&lt;p&gt;First, unpack the desired RPM files into a specific folder. This step assumes you have already downloaded or have access to the RPM files you wish to include in your local repository.&lt;/p&gt;

&lt;h2 id=&quot;installing-necessary-tools&quot;&gt;Installing Necessary Tools&lt;/h2&gt;

&lt;p&gt;To create and manage your local repository, you will need yum-utils and createrepo. Install these using the following commands:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;yum &lt;span class=&quot;nb&quot;&gt;install &lt;/span&gt;yum-utils createrepo
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;These tools provide utilities to manage your YUM configuration and create the metadata needed for a YUM repository.&lt;/p&gt;

&lt;h2 id=&quot;creating-your-local-repository&quot;&gt;Creating Your Local Repository&lt;/h2&gt;

&lt;p&gt;Next, use createrepo to create a local repository. This command turns a directory of RPMs into a repository that YUM can use.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;createrepo /your/local/folder/with/rpms
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Replace &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/your/local/folder/with/rpms&lt;/code&gt; with the path to the directory where you have stored your RPM files.&lt;/p&gt;

&lt;h2 id=&quot;managing-yum-cache&quot;&gt;Managing YUM Cache&lt;/h2&gt;

&lt;p&gt;Before using your new repository, it’s necessary to clear YUM’s cache and create a new one. This ensures that YUM recognizes your newly created repository.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;yum clean all
yum makecache
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;configuring-yum-to-use-the-local-repository&quot;&gt;Configuring YUM to Use the Local Repository&lt;/h2&gt;

&lt;p&gt;To use your new local repository, disable all other repositories and enable your newly created one. Here’s how to do it:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;yum &lt;span class=&quot;nt&quot;&gt;--disablerepo&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;*&quot;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;--enablerepo&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;myrepo&quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Replace myrepo with the real name of your repository. Note that this command should be followed by an action like an installation command; otherwise, it just sets up the configuration without performing any tasks.&lt;/p&gt;

&lt;p&gt;If you do not know the name of the local repo, use &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;yum repolist&lt;/code&gt; command to get all available repos.&lt;/p&gt;

&lt;h2 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h2&gt;

&lt;p&gt;Setting up a local YUM repository on Rocky Linux is straightforward and extremely useful for controlled environments or offline systems. By unpacking RPMs, installing yum-utils and createrepo, initializing your local repository, managing YUM cache, and configuring YUM to use the local repository, you ensure a reliable and controlled package management setup. Remember to regularly update your local repository with new or updated RPMs as needed.&lt;/p&gt;</content><author><name>{&quot;name&quot;=&gt;nil, &quot;avatar&quot;=&gt;nil, &quot;bio&quot;=&gt;&quot;&quot;, &quot;location&quot;=&gt;nil, &quot;email&quot;=&gt;nil}</name></author><category term="linux" /><summary type="html"></summary></entry><entry><title type="html">How I set DNS name as a hostname</title><link href="http://localhost:4000/applied-dnsname-as-hostname/" rel="alternate" type="text/html" title="How I set DNS name as a hostname" /><published>2023-11-07T22:50:00+01:00</published><updated>2023-11-07T22:50:00+01:00</updated><id>http://localhost:4000/applied-dnsname-as-hostname</id><content type="html" xml:base="http://localhost:4000/applied-dnsname-as-hostname/">&lt;h2 id=&quot;introduction&quot;&gt;Introduction&lt;/h2&gt;
&lt;p&gt;When configuring a new Rocky VM in my home lab, I decided to experiment with setting the hostname dynamically based on the DNS resolution.&lt;/p&gt;

&lt;p&gt;Here’s an overview of my process:&lt;/p&gt;

&lt;h2 id=&quot;initial-attempts-with-the-dig-command&quot;&gt;Initial Attempts with the dig Command&lt;/h2&gt;

&lt;p&gt;My first step involved preparing the environment for DNS queries. I installed the dnspython package to facilitate DNS lookups:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;admin@workstation ansible_activity]&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;pip &lt;span class=&quot;nb&quot;&gt;install &lt;/span&gt;dnspython

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Following that, I updated the community.general collection to ensure all Ansible modules were up-to-date:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;admin@workstation ansible_activity]&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;ansible-galaxy collection &lt;span class=&quot;nb&quot;&gt;install &lt;/span&gt;community.general
Process &lt;span class=&quot;nb&quot;&gt;install &lt;/span&gt;dependency map
Starting collection &lt;span class=&quot;nb&quot;&gt;install &lt;/span&gt;process
Installing &lt;span class=&quot;s1&quot;&gt;'community.general:8.0.1'&lt;/span&gt; to &lt;span class=&quot;s1&quot;&gt;'/home/admin/.ansible/collections/ansible_collections/community/general'&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;These installations were necessary prerequisites for utilizing the dig command within Ansible. However, the dig command did not return the expected DNS name, prompting me to switch to nslookup.&lt;/p&gt;

&lt;h2 id=&quot;setting-the-hostname&quot;&gt;Setting the Hostname&lt;/h2&gt;

&lt;h3 id=&quot;extracting-output-from-nslookup&quot;&gt;Extracting Output from nslookup&lt;/h3&gt;

&lt;p&gt;To accurately retrieve the DNS name of the host, I utilized a regular expression within Ansible. Here’s the regex I applied:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;regex_search&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'name\\s+=\\s+(.*)'&lt;/span&gt;, &lt;span class=&quot;s1&quot;&gt;'\\1'&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Breaking down the regex components:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;regex_search&lt;/code&gt; is an Ansible filter that conducts a regex pattern search within a string.&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;name&lt;/code&gt; signals the literal string we’re searching for in the input.&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;\\s+&lt;/code&gt; identifies one or more whitespace characters.&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;=&lt;/code&gt; is the literal equal sign.&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;\\s+&lt;/code&gt; (repeated) indicates additional whitespace characters following the equal sign.&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;(.*)&lt;/code&gt; captures all subsequent characters, denoting the target DNS name.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;The entire pattern &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;name\\s+=\\s+(.*)&lt;/code&gt; is designed to locate the line that begins with “name”, followed by whitespace, an equal sign, more whitespace, and finally the DNS name.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;\\1&lt;/code&gt; is a backreference to the content captured by the regex.&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;|&lt;/code&gt; first ensures that if multiple matches are found, only the first (and most relevant) result is used.&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;ansible-playbook-incorporating-regex&quot;&gt;Ansible Playbook Incorporating Regex&lt;/h3&gt;

&lt;p&gt;The following playbook snippet implements the aforementioned regex pattern to retrieve and set the DNS name:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;- name: Get the DNS name &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;the host using nslookup
  &lt;span class=&quot;nb&quot;&gt;command&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;nslookup {{ inventory_hostname }}&quot;&lt;/span&gt;
  register: nslookup_output

- name: Get the DNS name &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;the host
  set_fact:
    dns_hostname: &lt;span class=&quot;s2&quot;&gt;&quot;{{ nslookup_output.stdout | regex_search('name&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\\&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;s+=&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\\&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;s+(.*)', '&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\\&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;1') }}&quot;&lt;/span&gt; 

- name: Set the &lt;span class=&quot;nb&quot;&gt;hostname &lt;/span&gt;using shell
  shell: &lt;span class=&quot;s2&quot;&gt;&quot;hostnamectl set-hostname {{ dns_hostname }}&quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This playbook performs a DNS lookup, extracts the DNS name using the defined regex, and then uses that name to set the system’s hostname.&lt;/p&gt;</content><author><name>{&quot;name&quot;=&gt;nil, &quot;avatar&quot;=&gt;nil, &quot;bio&quot;=&gt;&quot;&quot;, &quot;location&quot;=&gt;nil, &quot;email&quot;=&gt;nil}</name></author><category term="ansible" /><category term="linux" /><summary type="html"></summary></entry><entry><title type="html">excel automation: enabling and using macros for date-time stamps</title><link href="http://localhost:4000/excel-automation-set-timedate-automatically/" rel="alternate" type="text/html" title="excel automation: enabling and using macros for date-time stamps" /><published>2023-10-31T22:50:00+01:00</published><updated>2023-10-31T22:50:00+01:00</updated><id>http://localhost:4000/excel-automation-set-timedate-automatically</id><content type="html" xml:base="http://localhost:4000/excel-automation-set-timedate-automatically/">&lt;p&gt;To enable and work with macro-enabled files in Excel and ensure the macros run correctly, you must follow some steps. This article provides a guide on how to enable macro-enabled file types and how to apply a specific VBA macro.&lt;/p&gt;

&lt;h2 id=&quot;enabling-macro-enabled-file-types&quot;&gt;Enabling Macro-Enabled File Types&lt;/h2&gt;

&lt;p&gt;&lt;strong&gt;Save as Macro-Enabled Workbook&lt;/strong&gt;:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;After creating or editing your macros in Excel, go to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;File&lt;/code&gt; &amp;gt; &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Save As&lt;/code&gt;.&lt;/li&gt;
  &lt;li&gt;Locate where you want to save the workbook.&lt;/li&gt;
  &lt;li&gt;Click on ‘Save as type’ dropdown and select &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Excel Macro-Enabled Workbook (*.xlsm)&lt;/code&gt;.&lt;/li&gt;
  &lt;li&gt;Set a name for workbook and click &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Save&lt;/code&gt;.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;strong&gt;Enable Macros when Opening a Workbook&lt;/strong&gt;:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;When you open an Excel file that contains macros, you might see a security warning under the ribbon. Click on &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Enable Content&lt;/code&gt; to run the macros.
&amp;lt;!–
&lt;strong&gt;Adjust Macro Settings&lt;/strong&gt;:&lt;/li&gt;
  &lt;li&gt;Go to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;File&lt;/code&gt; &amp;gt; &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Options&lt;/code&gt; &amp;gt; &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Trust Center&lt;/code&gt;.&lt;/li&gt;
  &lt;li&gt;Click on &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Trust Center Settings&lt;/code&gt;.&lt;/li&gt;
  &lt;li&gt;Under &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Macro Settings&lt;/code&gt;, choose the desired level of security. For full functionality, you can choose &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Enable all macros&lt;/code&gt; (not recommended for all documents due to security risks). It’s generally better to choose &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Disable all macros with notification&lt;/code&gt; so you can choose when to enable macros.&lt;/li&gt;
  &lt;li&gt;Click &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;OK&lt;/code&gt; to save your settings.
–&amp;gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;implementing-the-macro&quot;&gt;Implementing the Macro&lt;/h2&gt;

&lt;p&gt;To insert the current date and time in column A when a cell in column B is edited:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;Open VBA editor in Excel&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;In the Project Explorer on the left, double-click the worksheet where you want this behavior.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;In the code window, paste the following VBA code:&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;pre&gt;&lt;code class=&quot;language-vba&quot;&gt;Private Sub Worksheet_Change(ByVal Target As Range)
    'Check if the changed cell is in column B
    If Not Intersect(Target, Range(&quot;B:B&quot;)) Is Nothing Then
        'Set the corresponding cell in column A to the current date and time
        Cells(Target.Row, 1).Value = Now
    End If
End Sub
&lt;/code&gt;&lt;/pre&gt;

&lt;ul&gt;
  &lt;li&gt;Save and close the VBA editor.&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;how-it-works&quot;&gt;How it Works&lt;/h2&gt;

&lt;p&gt;The provided VBA code utilizes the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Worksheet_Change&lt;/code&gt; event, which is triggered whenever a change is made to the worksheet. The code checks if the edited cell is in column B. If it is, it updates the corresponding cell in column A with the current date and time.&lt;/p&gt;

&lt;p&gt;Remember to always be cautious when enabling macros, especially if the source of the Excel file is unknown. Macros can contain harmful code, so only enable macros from trusted sources.&lt;/p&gt;

&lt;h2 id=&quot;reference&quot;&gt;Reference&lt;/h2&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.planetaexcel.ru/techniques/6/44/&quot;&gt;Автоматическая вставка текущей даты в ячейку при вводе данных&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content><author><name>{&quot;name&quot;=&gt;nil, &quot;avatar&quot;=&gt;nil, &quot;bio&quot;=&gt;&quot;&quot;, &quot;location&quot;=&gt;nil, &quot;email&quot;=&gt;nil}</name></author><category term="excel" /><summary type="html"></summary></entry><entry><title type="html">Creating fedora linux cloud init template for proxmox manually</title><link href="http://localhost:4000/fedora-template-proxmox-manually/" rel="alternate" type="text/html" title="Creating fedora linux cloud init template for proxmox manually" /><published>2022-08-29T19:00:00+02:00</published><updated>2022-08-29T19:00:00+02:00</updated><id>http://localhost:4000/fedora-template-proxmox-manually</id><content type="html" xml:base="http://localhost:4000/fedora-template-proxmox-manually/">&lt;ol&gt;
  &lt;li&gt;Download fedora cloud image from https://alt.fedoraproject.org/cloud/. I used to download the last version in raw image&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&quot;creating-vm-in-terminal&quot;&gt;Creating VM in terminal&lt;/h2&gt;

&lt;p&gt;A VM creating process I ran in proxmox terminal using the following commands:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Create a new VM. Here I defined a machine with internal Proxmox ID 403, with memory 4 GB, two cores and with two network interfaces. Name of the VM will fedora-cloud.&lt;/li&gt;
&lt;/ol&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@proxmox:~# qm create 403 &lt;span class=&quot;nt&quot;&gt;--memory&lt;/span&gt; 4096 &lt;span class=&quot;nt&quot;&gt;--cores&lt;/span&gt; 2 &lt;span class=&quot;nt&quot;&gt;--name&lt;/span&gt; fedora-cloud &lt;span class=&quot;nt&quot;&gt;--net0&lt;/span&gt; virtio,bridge&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;vmbr0 &lt;span class=&quot;nt&quot;&gt;--net1&lt;/span&gt; virtio,bridge&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;vmbr1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ol&gt;
  &lt;li&gt;Here will the downloaded raw image will be imported to the VM as a hard drive and the image will be transfered to ocp1 storage&lt;/li&gt;
&lt;/ol&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@proxmox:~# qm importdisk 403 /var/tmp/Fedora-Cloud-Base-36-1.5.x86_64.raw ocp1
importing disk &lt;span class=&quot;s1&quot;&gt;'/var/tmp/Fedora-Cloud-Base-36-1.5.x86_64.raw'&lt;/span&gt; to VM 403 ...
Formatting &lt;span class=&quot;s1&quot;&gt;'/mnt/pve/ocp1/images/403/vm-403-disk-0.raw'&lt;/span&gt;, &lt;span class=&quot;nb&quot;&gt;fmt&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;raw &lt;span class=&quot;nv&quot;&gt;size&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;5368709120
transferred 0.0 B of 5.0 GiB &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;0.00%&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
transferred 52.2 MiB of 5.0 GiB &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;1.02%&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
transferred 103.9 MiB of 5.0 GiB &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;2.03%&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
.....
.....
transferred 5.0 GiB of 5.0 GiB &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;100.00%&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
transferred 5.0 GiB of 5.0 GiB &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;100.00%&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
Successfully imported disk as &lt;span class=&quot;s1&quot;&gt;'unused0:ocp1:403/vm-403-disk-0.raw'&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The uploaded image currently has a label unused, because it has not been attached to the the VM yet. And name of the image has been changed to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;vm-403-disk-0.raw&lt;/code&gt;. Let’s attach the image to the VM.&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Attaching an image to the VM. I use a default SCSI controller.&lt;/li&gt;
&lt;/ol&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@proxmox:~# qm &lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;403 &lt;span class=&quot;nt&quot;&gt;--scsihw&lt;/span&gt; virtio-scsi-pci &lt;span class=&quot;nt&quot;&gt;--scsi0&lt;/span&gt; ocp1:403/vm-403-disk-0.raw
update VM 403: &lt;span class=&quot;nt&quot;&gt;-scsi0&lt;/span&gt; ocp1:403/vm-403-disk-0.raw &lt;span class=&quot;nt&quot;&gt;-scsihw&lt;/span&gt; virtio-scsi-pci
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ol&gt;
  &lt;li&gt;Add cloud-init drive&lt;/li&gt;
&lt;/ol&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@proxmox:~# qm &lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;403 &lt;span class=&quot;nt&quot;&gt;--ide1&lt;/span&gt; ocp1:cloudinit
update VM 403: &lt;span class=&quot;nt&quot;&gt;-ide1&lt;/span&gt; ocp1:cloudinit
Formatting &lt;span class=&quot;s1&quot;&gt;'/mnt/pve/ocp1/images/403/vm-403-cloudinit.qcow2'&lt;/span&gt;, &lt;span class=&quot;nb&quot;&gt;fmt&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;qcow2 &lt;span class=&quot;nv&quot;&gt;cluster_size&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;65536 &lt;span class=&quot;nv&quot;&gt;extended_l2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;off &lt;span class=&quot;nv&quot;&gt;preallocation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;metadata &lt;span class=&quot;nv&quot;&gt;compression_type&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;zlib &lt;span class=&quot;nv&quot;&gt;size&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;4194304 &lt;span class=&quot;nv&quot;&gt;lazy_refcounts&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;off &lt;span class=&quot;nv&quot;&gt;refcount_bits&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;16
root@proxmox:~# 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ol&gt;
  &lt;li&gt;Make the cloudinit drive bootable and define in BIOS the boot starts from disk:&lt;/li&gt;
&lt;/ol&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@proxmox:~# qm &lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;403 &lt;span class=&quot;nt&quot;&gt;--boot&lt;/span&gt; c &lt;span class=&quot;nt&quot;&gt;--bootdisk&lt;/span&gt; scsi0
update VM 403: &lt;span class=&quot;nt&quot;&gt;-boot&lt;/span&gt; c &lt;span class=&quot;nt&quot;&gt;-bootdisk&lt;/span&gt; scsi0
root@proxmox:~# 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ol&gt;
  &lt;li&gt;And finally set serial to enable a web VNC. &lt;strong&gt;Not relevant&lt;/strong&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@proxmox:~# qm &lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;403 &lt;span class=&quot;nt&quot;&gt;--serial0&lt;/span&gt; socket &lt;span class=&quot;nt&quot;&gt;--vga&lt;/span&gt; serial0
update VM 403: &lt;span class=&quot;nt&quot;&gt;-serial0&lt;/span&gt; socket &lt;span class=&quot;nt&quot;&gt;-vga&lt;/span&gt; serial0
root@proxmox:~# 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ol&gt;
  &lt;li&gt;Create a template from the VM&lt;/li&gt;
&lt;/ol&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@proxmox:~# qm template 403
root@proxmox:~# 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Cloud-init configuration is able to define before creating a template or for any single VM that are being defined from the template.&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Clone a VM from the template:&lt;/li&gt;
&lt;/ol&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@proxmox:~# qm clone 403 103 &lt;span class=&quot;nt&quot;&gt;--name&lt;/span&gt; test-vm &lt;span class=&quot;nt&quot;&gt;--full&lt;/span&gt;
create full clone of drive ide1 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;ocp1:403/vm-403-cloudinit.qcow2&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
Formatting &lt;span class=&quot;s1&quot;&gt;'/mnt/pve/ocp1/images/103/vm-103-cloudinit.qcow2'&lt;/span&gt;, &lt;span class=&quot;nb&quot;&gt;fmt&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;qcow2 &lt;span class=&quot;nv&quot;&gt;cluster_size&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;65536 &lt;span class=&quot;nv&quot;&gt;extended_l2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;off &lt;span class=&quot;nv&quot;&gt;preallocation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;metadata &lt;span class=&quot;nv&quot;&gt;compression_type&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;zlib &lt;span class=&quot;nv&quot;&gt;size&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;4194304 &lt;span class=&quot;nv&quot;&gt;lazy_refcounts&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;off &lt;span class=&quot;nv&quot;&gt;refcount_bits&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;16
create full clone of drive scsi0 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;ocp1:403/base-403-disk-0.raw&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
Formatting &lt;span class=&quot;s1&quot;&gt;'/mnt/pve/ocp1/images/103/vm-103-disk-0.raw'&lt;/span&gt;, &lt;span class=&quot;nb&quot;&gt;fmt&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;raw &lt;span class=&quot;nv&quot;&gt;size&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;5368709120
transferred 0.0 B of 5.0 GiB &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;0.00%&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
transferred 51.7 MiB of 5.0 GiB &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;1.01%&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
.....
transferred 5.0 GiB of 5.0 GiB &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;100.00%&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;reference&quot;&gt;Reference&lt;/h2&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://pve.proxmox.com/wiki/Cloud-Init_Support&quot;&gt;Proxmox Cloud-Init Support&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://docs.technotim.live/posts/cloud-init-cloud-image/&quot;&gt;Creating cloud init cloud image&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content><author><name>{&quot;name&quot;=&gt;nil, &quot;avatar&quot;=&gt;nil, &quot;bio&quot;=&gt;&quot;&quot;, &quot;location&quot;=&gt;nil, &quot;email&quot;=&gt;nil}</name></author><category term="proxmox" /><summary type="html"></summary></entry><entry><title type="html">Creating a cloud-init VM Template on Proxmox using packer</title><link href="http://localhost:4000/first-vm-template-using-packer/" rel="alternate" type="text/html" title="Creating a cloud-init VM Template on Proxmox using packer" /><published>2022-07-01T19:00:00+02:00</published><updated>2022-07-01T19:00:00+02:00</updated><id>http://localhost:4000/first-vm-template-using-packer</id><content type="html" xml:base="http://localhost:4000/first-vm-template-using-packer/">&lt;p&gt;Recently I built up a virtual machine template on Proxmox using Packer. Here below I am going to show which steps were followed in order to achive the aim. I am going to set up VM with CentOS 8 Stream on board.&lt;/p&gt;

&lt;h2 id=&quot;installing-packer&quot;&gt;Installing Packer&lt;/h2&gt;

&lt;p&gt;&lt;a href=&quot;https://learn.hashicorp.com/tutorials/packer/get-started-install-cli&quot;&gt;Here&lt;/a&gt; is shown how to install Packer. Generally, I used the following steps for installing a required packages on my Fedora Workstation:&lt;/p&gt;

&lt;p&gt;Installing official HarshiCorp repository:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;yum-config-manager &lt;span class=&quot;nt&quot;&gt;--add-repo&lt;/span&gt; https://rpm.releases.hashicorp.com/RHEL/hashicorp.repo
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;yum-config-manager&lt;/code&gt; is not available on the host, install &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;yum-utils&lt;/code&gt; package: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sudo yum install -y yum-utils&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;And install packer:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo yum -y install packer
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And that’s it. Packer is installed. Check it:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;admin@workstation packer]&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;packer 
Usage: packer &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;--version&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;--help&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &amp;lt;&lt;span class=&quot;nb&quot;&gt;command&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&amp;lt;args&amp;gt;]

Available commands are:
    build           build image&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; from template
    console         creates a console &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;testing variable interpolation
    fix             fixes templates from old versions of packer
    &lt;span class=&quot;nb&quot;&gt;fmt             &lt;/span&gt;Rewrites HCL2 config files to canonical format
    hcl2_upgrade    transform a JSON template into an HCL2 configuration
    init            Install missing plugins or upgrade plugins
    inspect         see components of a template
    plugins         Interact with Packer plugins and catalog
    validate        check that a template is valid
    version         Prints the Packer version

&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;admin@workstation packer]&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;packer &lt;span class=&quot;nt&quot;&gt;--version&lt;/span&gt;
1.8.0
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;admin@workstation packer]&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;create-a-hcl-file&quot;&gt;Create a hcl file&lt;/h2&gt;

&lt;p&gt;In order to set up a vm we need to declare a file with instructions for packer. There are two type of files: JSON files and HCL file.&lt;/p&gt;

&lt;p&gt;I used to apply following hcl file for my task. The file is starting by defining required plugins. This plugin will be installed using &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;packer init hcls/&lt;/code&gt;. In the following part are being declared variables. I declared &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;proxmox_api_url&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;proxmox_api_token_id&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;proxmox_api_token_secret&lt;/code&gt;. These variables are able to define in the external file, by passing as a command parameter and by defining in the the same hcl file. In my task I set the 2 variables in a external file and secret I gave in command line as a parameter.&lt;/p&gt;

&lt;p&gt;Second part of the file is consisting of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;source&lt;/code&gt; part. Here are defined main parameters of the VM, iso file, disk, network and etc.&lt;/p&gt;

&lt;p&gt;Third part is the building part what actually runs building process and after provisioning tasks.&lt;/p&gt;

&lt;div class=&quot;language-vim highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
packer &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  required_plugins &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    proxmox &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;version&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&amp;gt;= 1.0.6&quot;&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;source&lt;/span&gt;  &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;github.com/hashicorp/proxmox&quot;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

variable &lt;span class=&quot;s2&quot;&gt;&quot;proxmox_api_url&quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;string&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

variable &lt;span class=&quot;s2&quot;&gt;&quot;proxmox_api_token_id&quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;string&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

variable &lt;span class=&quot;s2&quot;&gt;&quot;proxmox_api_token_secret&quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;type&lt;/span&gt;      &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;string&lt;/span&gt;
  sensitive &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; true
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;source&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;proxmox&quot;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;centos8-packer&quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  proxmox_url &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;${var.proxmox_api_url}&quot;&lt;/span&gt;
  username    &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;${var.proxmox_api_token_id}&quot;&lt;/span&gt;
  token    &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;${var.proxmox_api_token_secret}&quot;&lt;/span&gt;

  insecure_skip_tls_verify &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; true

  node  &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;proxmox&quot;&lt;/span&gt;
  vm_id &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;108&quot;&lt;/span&gt;
  vm_name &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;centos8-packer&quot;&lt;/span&gt;
  template_description &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;centos8-packer description&quot;&lt;/span&gt;

  iso_file         &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;ocp1:iso/CentOS-Stream-8-x86_64-latest-dvd1.iso&quot;&lt;/span&gt;

  iso_storage_pool &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;local&quot;&lt;/span&gt;
  unmount_iso      &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; true

  qemu_agent &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; true

  scsi_controller &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;virtio-scsi-pci&quot;&lt;/span&gt;

  disks &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    disk_size         &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;15G&quot;&lt;/span&gt;
    format            &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;vmdk&quot;&lt;/span&gt;
    storage_pool      &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;ocp1&quot;&lt;/span&gt;
    storage_pool_type &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;directory&quot;&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;type&lt;/span&gt;              &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;virtio&quot;&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

  cores &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;2&quot;&lt;/span&gt;

  memory &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;4096&quot;&lt;/span&gt;

  network_adapters &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    model &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;virtio&quot;&lt;/span&gt;
    bridge &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;vmbr0&quot;&lt;/span&gt;
    firewall &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;false&quot;&lt;/span&gt;
   &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; 

  cloud_init              &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; true
  cloud_init_storage_pool &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;ocp1&quot;&lt;/span&gt;

  boot_command &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;&quot;&amp;lt;tab&amp;gt;&amp;lt;bs&amp;gt;&amp;lt;bs&amp;gt;&amp;lt;bs&amp;gt;&amp;lt;bs&amp;gt;&amp;lt;bs&amp;gt;text inst.ks=http://{{ .HTTPIP }}:{{ .HTTPPort }}/ks.conf&amp;lt;enter&amp;gt;&amp;lt;wait&amp;gt;&amp;lt;enter&amp;gt;&quot;&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
  boot      &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;c&quot;&lt;/span&gt;
  boot_wait &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;5s&quot;&lt;/span&gt;

  http_directory &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;http&quot;&lt;/span&gt; 

  ssh_username &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;admin&quot;&lt;/span&gt;
  ssh_private_key_file &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;~/.ssh/id_rsa&quot;&lt;/span&gt;
  ssh_password &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;admin&quot;&lt;/span&gt;
  ssh_port &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;22&lt;/span&gt;
  ssh_timeout &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;30m&quot;&lt;/span&gt;

&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

build &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;source&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;proxmox.centos8-packer&quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        name &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;centos8-packer&quot;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

    provisioner &lt;span class=&quot;s2&quot;&gt;&quot;shell&quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      inline &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;
        &lt;span class=&quot;c&quot;&gt;&quot;echo Installing Updates&quot;,&lt;/span&gt;
        &lt;span class=&quot;c&quot;&gt;&quot;yum update -y&quot;,&lt;/span&gt;
        &lt;span class=&quot;c&quot;&gt;&quot;yum install -y cloud-init qemu-guest-agent cloud-utils-growpart gdisk&quot;,&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;

      &lt;span class=&quot;k&quot;&gt;only&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;proxmox&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;By running packer creates a temporary http server using a randomly generated port. Such approach allows to download a kicstart file during installation and set up a machine. Kickstart file is located in &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;http&lt;/code&gt; folder (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;http_directory = &quot;http&quot;&lt;/code&gt;). The kickstart file that I used for this task is shared on github. &lt;a href=&quot;https://github.com/votamrima/terraforming/blob/master/packer/http/ks.conf&quot;&gt;Link&lt;/a&gt;&lt;/p&gt;

&lt;h2 id=&quot;running-packer&quot;&gt;Running Packer&lt;/h2&gt;

&lt;p&gt;First of all we need to install required plugin for packer.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;admin@workstation packer]&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;packer init hcls/
Installed plugin github.com/hashicorp/proxmox v1.0.8 &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;/home/admin/.config/packer/plugins/github.com/hashicorp/proxmox/packer-plugin-proxmox_v1.0.8_x5.0_linux_amd64&quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And check installed plugin:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;admin@workstation packer]&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;packer plugins installed
/home/admin/.config/packer/plugins/github.com/hashicorp/proxmox/packer-plugin-proxmox_v1.0.8_x5.0_linux_amd64
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Next step is setting up a machine.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;admin@workstation packer]&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;packer build &lt;span class=&quot;nt&quot;&gt;-var-file&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'creds.pkr.hcl'&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-var&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;proxmox_api_token_secret&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&amp;lt;my-secret&amp;gt;&quot;&lt;/span&gt; hcls/proxmox-centos.pkr.hcl
proxmox.centos8-packer: output will be &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;this color.

&lt;span class=&quot;o&quot;&gt;==&amp;gt;&lt;/span&gt; proxmox.centos8-packer: Creating VM
&lt;span class=&quot;o&quot;&gt;==&amp;gt;&lt;/span&gt; proxmox.centos8-packer: Starting VM
&lt;span class=&quot;o&quot;&gt;==&amp;gt;&lt;/span&gt; proxmox.centos8-packer: Starting HTTP server on port 8665
&lt;span class=&quot;o&quot;&gt;==&amp;gt;&lt;/span&gt; proxmox.centos8-packer: Waiting 5s &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;boot
&lt;span class=&quot;o&quot;&gt;==&amp;gt;&lt;/span&gt; proxmox.centos8-packer: Typing the boot &lt;span class=&quot;nb&quot;&gt;command&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;==&amp;gt;&lt;/span&gt; proxmox.centos8-packer: Waiting &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;SSH to become available...
&lt;span class=&quot;o&quot;&gt;==&amp;gt;&lt;/span&gt; proxmox.centos8-packer: Connected to SSH!
&lt;span class=&quot;o&quot;&gt;==&amp;gt;&lt;/span&gt; proxmox.centos8-packer: Stopping VM
&lt;span class=&quot;o&quot;&gt;==&amp;gt;&lt;/span&gt; proxmox.centos8-packer: Converting VM to template
&lt;span class=&quot;o&quot;&gt;==&amp;gt;&lt;/span&gt; proxmox.centos8-packer: Adding a cloud-init cdrom &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;storage pool ocp1
Build &lt;span class=&quot;s1&quot;&gt;'proxmox.centos8-packer'&lt;/span&gt; finished after 8 minutes 35 seconds.

&lt;span class=&quot;o&quot;&gt;==&amp;gt;&lt;/span&gt; Wait completed after 8 minutes 35 seconds

&lt;span class=&quot;o&quot;&gt;==&amp;gt;&lt;/span&gt; Builds finished. The artifacts of successful builds are:
&lt;span class=&quot;nt&quot;&gt;--&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; proxmox.centos8-packer: A template was created: 108

&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;admin@workstation packer]&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h2 id=&quot;reference&quot;&gt;Reference&lt;/h2&gt;</content><author><name>{&quot;name&quot;=&gt;nil, &quot;avatar&quot;=&gt;nil, &quot;bio&quot;=&gt;&quot;&quot;, &quot;location&quot;=&gt;nil, &quot;email&quot;=&gt;nil}</name></author><category term="packer" /><summary type="html">Recently I built up a virtual machine template on Proxmox using Packer. Here below I am going to show which steps were followed in order to achive the aim. I am going to set up VM with CentOS 8 Stream on board.</summary></entry><entry><title type="html">First steps in helm</title><link href="http://localhost:4000/first-touch-with-helm/" rel="alternate" type="text/html" title="First steps in helm" /><published>2022-06-19T19:00:00+02:00</published><updated>2022-06-19T19:00:00+02:00</updated><id>http://localhost:4000/first-touch-with-helm</id><content type="html" xml:base="http://localhost:4000/first-touch-with-helm/">&lt;p&gt;Here I would like to describe my first steps in learning helm.&lt;/p&gt;

&lt;h2 id=&quot;installation&quot;&gt;Installation&lt;/h2&gt;

&lt;p&gt;I installed Helm using following instruction:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Downloaded the latest version from the website: &lt;a href=&quot;https://github.com/helm/helm/releases&quot;&gt;https://github.com/helm/helm/releases&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;Unpacked the archive: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;tar fzx helm-v3.9.0-linux-amd64.tar.gz&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;Set following string into ~/.bashrc&lt;/li&gt;
&lt;/ol&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;HELM_PATH&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;/opt/helm/linux-amd64&quot;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;PATH&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$PATH&lt;/span&gt;:&lt;span class=&quot;nv&quot;&gt;$HELM_PATH&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;using-helm&quot;&gt;Using Helm&lt;/h2&gt;

&lt;p&gt;Adding a new repo:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;admin@podman helm]&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;helm repo add bitnami https://charts.bitnami.com/bitnami
&lt;span class=&quot;s2&quot;&gt;&quot;bitnami&quot;&lt;/span&gt; has been added to your repositories
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Listing all existing repos on the machine:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;admin@podman helm]&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;helm repo add bitnami https://charts.bitnami.com/bitnami
&lt;span class=&quot;s2&quot;&gt;&quot;bitnami&quot;&lt;/span&gt; has been added to your repositories
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;create-helm-chart&quot;&gt;Create helm chart&lt;/h2&gt;

&lt;p&gt;First of all I run helm create command:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;admin@workstation first-chart]&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;helm create first-chart
Creating first-chart
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Secondly, customized some values in values.yml file. This is my first chart therefore I did edit some few lines.&lt;/p&gt;

&lt;p&gt;So, was set &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nameOverride&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;fullnameOverride&lt;/code&gt; values:&lt;/p&gt;

&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;na&quot;&gt;nameOverride&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;first-chart&quot;&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;fullnameOverride&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;first-chart&quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Then, was updated name value in serviceAccount:&lt;/p&gt;

&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;na&quot;&gt;serviceAccount&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;create&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;true&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;annotations&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;pi&quot;&gt;{}&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;firstapp&quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And finally, I changed service type from default &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ClusterIP&lt;/code&gt; to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;NodePort&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;na&quot;&gt;service&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;NodePort&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;80&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;To install this helm chart I run the following command:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;admin@workstation first-chart]&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;helm &lt;span class=&quot;nb&quot;&gt;install &lt;/span&gt;first-chart first-chart/ &lt;span class=&quot;nt&quot;&gt;--values&lt;/span&gt; first-chart/values.yaml 
NAME: first-chart
LAST DEPLOYED: Sun Jun 19 17:23:24 2022
NAMESPACE: default
STATUS: deployed
REVISION: 1
NOTES:
1. Get the application URL by running these commands:
  &lt;span class=&quot;nb&quot;&gt;export &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;NODE_PORT&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;$(&lt;/span&gt;kubectl get &lt;span class=&quot;nt&quot;&gt;--namespace&lt;/span&gt; default &lt;span class=&quot;nt&quot;&gt;-o&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;jsonpath&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;{.spec.ports[0].nodePort}&quot;&lt;/span&gt; services first-chart&lt;span class=&quot;si&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;export &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;NODE_IP&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;$(&lt;/span&gt;kubectl get nodes &lt;span class=&quot;nt&quot;&gt;--namespace&lt;/span&gt; default &lt;span class=&quot;nt&quot;&gt;-o&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;jsonpath&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;{.items[0].status.addresses[0].address}&quot;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;echo &lt;/span&gt;http://&lt;span class=&quot;nv&quot;&gt;$NODE_IP&lt;/span&gt;:&lt;span class=&quot;nv&quot;&gt;$NODE_PORT&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;admin@workstation first-chart]&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;kubectl get pods
NAME                           READY   STATUS              RESTARTS   AGE
first-chart-6cd58dc9ff-bh9lw   0/1     ContainerCreating   0          11s
myhello-5586c5c9bf-zmktx       1/1     Running             3          3d
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;admin@workstation first-chart]&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;kubectl get pods
NAME                           READY   STATUS              RESTARTS   AGE
first-chart-6cd58dc9ff-bh9lw   0/1     ContainerCreating   0          15s
myhello-5586c5c9bf-zmktx       1/1     Running             3          3d
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;admin@workstation first-chart]&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;watch kubectl get pods
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And check the status of the kubernetes pod:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;admin@workstation first-chart]&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;kubectl get pods
NAME                           READY   STATUS    RESTARTS   AGE
first-chart-6cd58dc9ff-bh9lw   1/1     Running   0          17s
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;admin@workstation first-chart]&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;references&quot;&gt;References&lt;/h2&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://helm.sh/docs&quot;&gt;Helm documentation&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://phoenixnap.com/kb/create-helm-chart&quot;&gt;How To Create A Helm Chart&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content><author><name>{&quot;name&quot;=&gt;nil, &quot;avatar&quot;=&gt;nil, &quot;bio&quot;=&gt;&quot;&quot;, &quot;location&quot;=&gt;nil, &quot;email&quot;=&gt;nil}</name></author><category term="helm" /><summary type="html"></summary></entry><entry><title type="html">How I deployed my first app in kubernetes</title><link href="http://localhost:4000/deploy-simple-app-in-kubernetes/" rel="alternate" type="text/html" title="How I deployed my first app in kubernetes" /><published>2022-06-01T09:00:00+02:00</published><updated>2022-06-01T09:00:00+02:00</updated><id>http://localhost:4000/deploy-simple-app-in-kubernetes</id><content type="html" xml:base="http://localhost:4000/deploy-simple-app-in-kubernetes/">&lt;p&gt;In this post I am going to describe how I deployed my python service on kubernetes and how I realized connection to external database.&lt;/p&gt;

&lt;h2 id=&quot;about-application&quot;&gt;About application&lt;/h2&gt;

&lt;p&gt;The test application is based on FastAPI module. Main purpose of the service is handling incomming requests and save them into the databse. For database system I used Postgres.&lt;/p&gt;

&lt;p&gt;Connection values and other variables were defined in &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.env&lt;/code&gt; file located in application running folder.&lt;/p&gt;

&lt;h2 id=&quot;deploy-application&quot;&gt;Deploy application&lt;/h2&gt;

&lt;p&gt;First of all it was created a namespace:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;kubectl create namespace newsbase
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Then, deployed a secret file for pulling an image for the images registry. &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;auth.json&lt;/code&gt; file I found in /run/user/1000/containers/auth.json of the machine where the image registry is runnning:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;kubectl create secret generic regcred &lt;span class=&quot;nt&quot;&gt;--from-file&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;.dockerconfigjson&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;../auth.json &lt;span class=&quot;nt&quot;&gt;--type&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;kubernetes.io/dockerconfigjson &lt;span class=&quot;nt&quot;&gt;-n&lt;/span&gt; newsbase
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Next, prepare deployment.yml file and apply it afterwards:&lt;/p&gt;

&lt;p&gt;Content of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;deployment.yml&lt;/code&gt; file:&lt;/p&gt;

&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
&lt;span class=&quot;nn&quot;&gt;---&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;apps/v1&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;Deployment&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;newsbase&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;namespace&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;newsbase&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;selector&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;matchLabels&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;na&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;newsbase&lt;/span&gt;
      &lt;span class=&quot;na&quot;&gt;tier&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;newsbase&lt;/span&gt;
      &lt;span class=&quot;na&quot;&gt;track&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;stable&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;replicas&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;3&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;template&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;na&quot;&gt;labels&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;newsbase&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;track&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;stable&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;na&quot;&gt;containers&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;newsbase&lt;/span&gt;
          &lt;span class=&quot;na&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;registry.ocp.home.lab:5000/newsbase:1.0&quot;&lt;/span&gt;
          &lt;span class=&quot;na&quot;&gt;ports&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;newsbase&lt;/span&gt;
              &lt;span class=&quot;na&quot;&gt;containerPort&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;9080&lt;/span&gt;
              &lt;span class=&quot;na&quot;&gt;protocol&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;TCP&lt;/span&gt;
      &lt;span class=&quot;na&quot;&gt;imagePullSecrets&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;regcred&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This deployment.yml file describes following:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;application and namespace name is newsbase;&lt;/li&gt;
  &lt;li&gt;it will be running 3 pods: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;replicas: 3&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;image will be deployed from the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;registry.ocp.home.lab:5000/newsbase:1.0&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;port &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;9080&lt;/code&gt; will be exposed&lt;/li&gt;
  &lt;li&gt;secret named &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;regcred&lt;/code&gt; will be to access to the image registry;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;And apply &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;deployment.yml&lt;/code&gt; file:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;admin@workstation newsbase]&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;kubectl apply &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; deployment.yml 
deployment.apps/newsbase created
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Check if pods have been running:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;admin@workstation newsbase]&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;kubectl get pods &lt;span class=&quot;nt&quot;&gt;-n&lt;/span&gt; newsbase
NAME                        READY   STATUS    RESTARTS   AGE
newsbase-7c4bb87566-ghmv8   1/1     Running   1          5m
newsbase-7c4bb87566-jqnnr   1/1     Running   1          5m
newsbase-7c4bb87566-pqw68   1/1     Running   1          5m
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;admin@workstation newsbase]&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;activate-service-for-application&quot;&gt;Activate service for application&lt;/h2&gt;

&lt;p&gt;In order to access to the application I created service resource.&lt;/p&gt;

&lt;p&gt;Content of the service.yml is following:&lt;/p&gt;

&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;na&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;v1&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;Service&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;newsbase&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;namespace&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;newsbase&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;ports&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;9080&lt;/span&gt;
      &lt;span class=&quot;na&quot;&gt;nodePort&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;30080&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;selector&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;newsbase&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;NodePort&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;To apply a service run the similar command with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;apply&lt;/code&gt; argument:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;kubectl apply &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; service.yml
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;apply-endpoint-resource&quot;&gt;Apply endpoint resource&lt;/h2&gt;

&lt;p&gt;Endpoint I need configure connection to external database. Here is the yaml file of the resource&lt;/p&gt;

&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
&lt;span class=&quot;nn&quot;&gt;---&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;Service&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;v1&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;connection-to-db&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;namespace&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;newsbase&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;clusterIP&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;None&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;ports&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5432&lt;/span&gt;

&lt;span class=&quot;nn&quot;&gt;---&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;Endpoints&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;v1&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;connection-to-db&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;namespace&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;newsbase&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;subsets&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;addresses&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;ip&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;192.168.11.62&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;ports&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5432&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;connection-to-db&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;references&quot;&gt;References&lt;/h2&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://stackoverflow.com/questions/63344920/access-external-database-from-kubernetes&quot;&gt;access-external-database-from-kubernetes&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;/li&gt;
&lt;/ul&gt;</content><author><name>{&quot;name&quot;=&gt;nil, &quot;avatar&quot;=&gt;nil, &quot;bio&quot;=&gt;&quot;&quot;, &quot;location&quot;=&gt;nil, &quot;email&quot;=&gt;nil}</name></author><category term="kubernetes" /><summary type="html">In this post I am going to describe how I deployed my python service on kubernetes and how I realized connection to external database.</summary></entry><entry><title type="html">Basics of Ansible collections</title><link href="http://localhost:4000/ansible-collections/" rel="alternate" type="text/html" title="Basics of Ansible collections" /><published>2022-05-18T09:00:00+02:00</published><updated>2022-05-18T09:00:00+02:00</updated><id>http://localhost:4000/ansible-collections</id><content type="html" xml:base="http://localhost:4000/ansible-collections/">&lt;p&gt;Ansible collection provides set of roles, modules, some plugins that are able to download on ansible control host and use them in playbooks. For example, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;community.crypto&lt;/code&gt; collection provides modules for managing TLS/SSL certificates.&lt;/p&gt;

&lt;p&gt;Collections are supported by Ansible starting with version 2.9.&lt;/p&gt;

&lt;p&gt;Main benefit of collections: 
    - Ansible content collection gives flexibility. 
    - we can install set of only required modules instead all available ones. 
    - We can select specific version of the collection.&lt;/p&gt;

&lt;h3 id=&quot;collection-sources&quot;&gt;Collection sources&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;Ansible automation hub - official platform with collections. Red Hat officially reviews, updates, maintains collections at automation hub. The resource is available at &lt;a href=&quot;https://cloud.redhat.com/ansible/automation-hub/&quot;&gt;https://cloud.redhat.com/ansible/automation-hub/&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;Ansible Galaxy - is a somehow a market where organizations as well as developers can share their collections.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;By default ansible downloads collections from the galaxy. But it is able to configure in ansible.cfg file too:&lt;/p&gt;

&lt;div class=&quot;language-ini highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
&lt;span class=&quot;nn&quot;&gt;[galaxy]&lt;/span&gt;
&lt;span class=&quot;py&quot;&gt;server_list&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;automation_hub, galaxy&lt;/span&gt;

&lt;span class=&quot;nn&quot;&gt;[galaxy_server.automation_hub]&lt;/span&gt;
&lt;span class=&quot;py&quot;&gt;url&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;https://cloud.redhat.com/api/automation-hub/&lt;/span&gt;
&lt;span class=&quot;py&quot;&gt;auth_url&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;https://sso.redhat.com/auth/realms/redhat-external/protocol/openid-connect/token&lt;/span&gt;
&lt;span class=&quot;py&quot;&gt;token&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;sometocken&lt;/span&gt;

&lt;span class=&quot;nn&quot;&gt;[galaxy_server.galaxy]&lt;/span&gt;
&lt;span class=&quot;py&quot;&gt;url&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;https://galaxy.ansible.com/&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Instead of token we can use login and password as well:&lt;/p&gt;

&lt;div class=&quot;language-ini highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nn&quot;&gt;[galaxy_server.automation_hub]&lt;/span&gt;
&lt;span class=&quot;py&quot;&gt;url&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;https://cloud.redhat.com/api/automation-hub/&lt;/span&gt;
&lt;span class=&quot;py&quot;&gt;username&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;someuser&lt;/span&gt;
&lt;span class=&quot;py&quot;&gt;password&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;somepassword&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Or using a token in environment variable:&lt;/p&gt;

&lt;div class=&quot;language-ini highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nn&quot;&gt;[galaxy_server.automation_hub]&lt;/span&gt;
&lt;span class=&quot;py&quot;&gt;url&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;https://cloud.redhat.com/api/automation-hub/&lt;/span&gt;
&lt;span class=&quot;py&quot;&gt;auth_url&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;https://sso.redhat.com/auth/realms/redhat-external/protocol/openid-connect/token&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;ANSIBLE_GALAXY_SERVER_&amp;lt;server_id&amp;gt;_&amp;lt;key&amp;gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;value
&lt;span class=&quot;nv&quot;&gt;ANSIBLE_GALAXY_SERVER_AUTOMATION_HUB_TOKEN&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'tocken'&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;installing-collections&quot;&gt;Installing collections&lt;/h3&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;ansible-galaxy collection &lt;span class=&quot;nb&quot;&gt;install &lt;/span&gt;community.crypto
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Moreover, collections are able to be installed from a local or remote (webserver) tar archive, as well as roles:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;ansible-galaxy collection &lt;span class=&quot;nb&quot;&gt;install&lt;/span&gt; /&amp;lt;some-path&amp;gt;/&amp;lt;collection-name&amp;gt;.tar
ansible-galaxy collection &lt;span class=&quot;nb&quot;&gt;install &lt;/span&gt;http://&amp;lt;webserver&amp;gt;/&amp;lt;collection-name&amp;gt;.tar
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Using requirements file is able to install collections too:&lt;/p&gt;

&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
&lt;span class=&quot;s&quot;&gt;cat requirements.yml&lt;/span&gt;

  &lt;span class=&quot;s&quot;&gt;- my_namespace.my_collection&lt;/span&gt;

  &lt;span class=&quot;s&quot;&gt;- name&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;my_namespace.my_collection&lt;/span&gt;

  &lt;span class=&quot;s&quot;&gt;- name&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;my_namespace.my_collection&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;version&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;1.2.0&lt;/span&gt;

  &lt;span class=&quot;s&quot;&gt;- name&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;/tmp/collection-name.tar.gz&lt;/span&gt;

  &lt;span class=&quot;s&quot;&gt;- name&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;http://some-webserver/my_collection.tar.gz&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;using-collections&quot;&gt;Using collections&lt;/h3&gt;

&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
&lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;hosts&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;all&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;tasks&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;import_role&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;my_namespace.my_collection.role1&lt;/span&gt;

    &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;my_namespace.mycollection.mymodule&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;option1&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;value&lt;/span&gt;

    &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;debug&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;msg&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;{{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;lookup(&quot;my_namespace.my_collection.lookup1&quot;,&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'param1')| my_namespace.my_collection.filter1 }}'&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;To avoid a lot of typing, you can use the collections:&lt;/p&gt;

&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
&lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;hosts&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;all&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;collections&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
   &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;my_namespace.my_collection&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;tasks&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;import_role&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;role1&lt;/span&gt;

    &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;mymodule&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;option1&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;value&lt;/span&gt;

    &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;debug&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;msg&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;{{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;lookup(&quot;my_namespace.my_collection.lookup1&quot;,&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'param1')| my_namespace.my_collection.filter1 }}'&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Real example:&lt;/p&gt;

&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
  &lt;span class=&quot;na&quot;&gt;tasks&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;Deploy httpd server&lt;/span&gt;
      &lt;span class=&quot;na&quot;&gt;ansible.builtin.yum&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;httpd&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;state&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;present&lt;/span&gt;

    &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;Start up and activate httpd service&lt;/span&gt;
      &lt;span class=&quot;na&quot;&gt;ansible.builtin.service&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;httpd&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;state&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;started&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;enabled&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;true&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;references&quot;&gt;References&lt;/h2&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://docs.ansible.com/ansible/2.9/user_guide/collections_using.html&quot;&gt;Ansible user guide&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;Other sources&lt;/li&gt;
&lt;/ul&gt;</content><author><name>{&quot;name&quot;=&gt;nil, &quot;avatar&quot;=&gt;nil, &quot;bio&quot;=&gt;&quot;&quot;, &quot;location&quot;=&gt;nil, &quot;email&quot;=&gt;nil}</name></author><category term="ansible" /><summary type="html"></summary></entry><entry><title type="html">Basics of storage management using Ansible</title><link href="http://localhost:4000/ansible-basic-storage-management/" rel="alternate" type="text/html" title="Basics of storage management using Ansible" /><published>2022-05-15T14:00:00+02:00</published><updated>2022-05-15T14:00:00+02:00</updated><id>http://localhost:4000/ansible-basic-storage-management</id><content type="html" xml:base="http://localhost:4000/ansible-basic-storage-management/">&lt;p&gt;Generally, there are available 5 modules that allow to manage storage: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;parted&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;lvg&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;lvol&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;filesystem&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mount&lt;/code&gt;.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;parted&lt;/code&gt; module creates partition.&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;lvg&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;lvol&lt;/code&gt; - module are supporting to create logical volume groups.&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;filesystem&lt;/code&gt; - module creates a filesystem&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mount&lt;/code&gt; module mounts a created partition and insert mounting config to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/fstab&lt;/code&gt;.&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;code&quot;&gt;Code&lt;/h2&gt;

&lt;p&gt;Here below I share a basic playbook for managing storage:&lt;/p&gt;

&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;Create new partition&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;hosts&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;machinea&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;gather_facts&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;true&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;tasks&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;block managing storage&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;block&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;Create partition&lt;/span&gt;
      &lt;span class=&quot;na&quot;&gt;parted&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;device&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;{{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;item.device&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;}}&quot;&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;number&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;{{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;item.number&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;}}&quot;&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;state&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;{{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;item.state&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;}}&quot;&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;part_start&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;{{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;item.start&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;}}&quot;&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;part_end&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;{{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;item.end&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;}}&quot;&lt;/span&gt;
      &lt;span class=&quot;na&quot;&gt;loop&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;{{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;partitions&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;}}&quot;&lt;/span&gt;

    &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;Create volume group&lt;/span&gt;
      &lt;span class=&quot;na&quot;&gt;lvg&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;vg&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;{{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;item.vg_name&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;}}&quot;&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;pvs&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;{{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;item.vg_device&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;}}&quot;&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;state&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;{{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;item.vg_state&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;}}&quot;&lt;/span&gt;
      &lt;span class=&quot;na&quot;&gt;loop&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;{{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;partitions&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;}}&quot;&lt;/span&gt;

    &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;Create a logical volume&lt;/span&gt;
      &lt;span class=&quot;na&quot;&gt;lvol&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;vg&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;{{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;item.vg_group&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;}}&quot;&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;lv&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;{{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;item.lvol_name&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;}}&quot;&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;size&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;{{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;item.size&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;}}&quot;&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;state&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;{{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;item.state&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;}}&quot;&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;resizefs&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;{{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;item.resizefs&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;}}&quot;&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;force&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;{{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;item.force&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;}}&quot;&lt;/span&gt;
      &lt;span class=&quot;na&quot;&gt;loop&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;{{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;logical_volumes&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;}}&quot;&lt;/span&gt;
      
    &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;Defining filesystem&lt;/span&gt;
      &lt;span class=&quot;na&quot;&gt;filesystem&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;fstype&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;{{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;item.fstype&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;}}&quot;&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;dev&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;/dev/{{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;item.vg_group&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;}}/{{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;item.lvol_name&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;}}&quot;&lt;/span&gt;
      &lt;span class=&quot;na&quot;&gt;loop&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;{{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;logical_volumes&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;}}&quot;&lt;/span&gt;

    &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;Mount the volume&lt;/span&gt;
      &lt;span class=&quot;na&quot;&gt;mount&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;{{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;item.mount_path&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;}}&quot;&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;src&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;/dev/{{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;item.vg_group&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;}}/{{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;item.lvol_name&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;}}&quot;&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;opts&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;{{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;item.mount_opts&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;}}&quot;&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;state&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;{{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;item.mount_state&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;}}&quot;&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;fstype&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;{{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;item.fstype&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;}}&quot;&lt;/span&gt;
      &lt;span class=&quot;na&quot;&gt;loop&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;{{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;logical_volumes&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;}}&quot;&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;become&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;true&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;File with variables in this example is locating in &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;host_vars/machinea/vars.yml&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;na&quot;&gt;partitions&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;device&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;/dev/sdb&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;number&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;state&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;present&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;start&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;1MiB&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;end&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;1GiB&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;vg_name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;vg-a&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;vg_device&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;/dev/sdb1&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;vg_state&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;present&lt;/span&gt;

&lt;span class=&quot;na&quot;&gt;logical_volumes&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;lvol_name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;vol1&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;size&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;250&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;state&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;present&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;vg_group&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;vg-a&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;mount_path&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;/opt/testmount&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;state&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;present&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;resizefs&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;true&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;fstype&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;xfs&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;mount_state&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;mounted&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;mount_opts&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;noatime&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;force&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;true&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;reference&quot;&gt;Reference:&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ansible-doc&lt;/code&gt; command&lt;/li&gt;
&lt;/ul&gt;</content><author><name>{&quot;name&quot;=&gt;nil, &quot;avatar&quot;=&gt;nil, &quot;bio&quot;=&gt;&quot;&quot;, &quot;location&quot;=&gt;nil, &quot;email&quot;=&gt;nil}</name></author><category term="ansible" /><summary type="html"></summary></entry><entry><title type="html">Kubernetes installation. (Not finished)</title><link href="http://localhost:4000/kubernets-install/" rel="alternate" type="text/html" title="Kubernetes installation. (Not finished)" /><published>2022-05-10T09:00:00+02:00</published><updated>2022-05-10T09:00:00+02:00</updated><id>http://localhost:4000/kubernets-install</id><content type="html" xml:base="http://localhost:4000/kubernets-install/">&lt;p&gt;In this post I describe the installation process of a simple Kubernetes cluster. This post has not been finished yet.&lt;/p&gt;

&lt;p&gt;Cluster concists from 3 nodes: 1 master node, 2 worker nodes, based on Fedora 35 and all VMs are running at Proxmox.&lt;/p&gt;

&lt;h2 id=&quot;node-configuration&quot;&gt;Node configuration&lt;/h2&gt;

&lt;p&gt;Following steps should be proceeded on the all hosts of the futere cluster:&lt;/p&gt;

&lt;p&gt;Disable swap:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;swapoff &lt;span class=&quot;nt&quot;&gt;-a&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Additionally, in order to avoid some issues during settin up I disabled Selinux.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;swapoff &lt;span class=&quot;nt&quot;&gt;-a&lt;/span&gt;

vim /etc/selinux/config   &lt;span class=&quot;c&quot;&gt;# Set SELINUX=disabled&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Created kubernetes.conf and kubernetes.conf files:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;cat&lt;/span&gt; /etc/modules-load.d/kubernetes.conf
&lt;span class=&quot;c&quot;&gt;# networking&lt;/span&gt;
bridge
br_netfilter
&lt;span class=&quot;c&quot;&gt;# kata&lt;/span&gt;
vhost
vhost_net
vhost_vsock

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Create kubernetes repo file. But, do not activate it.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;vim /etc/yum.repos.d/kubernetes.repo
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;kubernetes]
&lt;span class=&quot;nv&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;Kubernetes
&lt;span class=&quot;nv&quot;&gt;baseurl&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;https://packages.cloud.google.com/yum/repos/kubernetes-el7-&lt;span class=&quot;nv&quot;&gt;$basearch&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;enabled&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0
&lt;span class=&quot;nv&quot;&gt;gpgcheck&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1
&lt;span class=&quot;nv&quot;&gt;repo_gpgcheck&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1
&lt;span class=&quot;nv&quot;&gt;gpgkey&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;https://packages.cloud.google.com/yum/doc/yum-key.gpg https://packages.cloud.google.com/yum/doc/rpm-package-key.gpg
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;installation&quot;&gt;Installation&lt;/h2&gt;

&lt;p&gt;I am going to use cri-o as a container engine for kubernetes. Following steps should be perform for all hosts.&lt;/p&gt;

&lt;p&gt;Check available versions of cri-o&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;dnf module list cri-o
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And enable the last available version. In my case it is 1.22:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;dnf module &lt;span class=&quot;nb&quot;&gt;enable &lt;/span&gt;cri-o:1.22
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Install necessary packages:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;dnf &lt;span class=&quot;nb&quot;&gt;install &lt;/span&gt;podman skopeo buildah runc cri-o cri-tools containernetworking-plugins bridge-utils telnet jq
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Install kubectl,kubeadm,kubelet from the kubernetes repository.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;dnf &lt;span class=&quot;nb&quot;&gt;install&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;--enablerepo&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;kubernetes &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;kubectl,kubeadm,kubelet&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Create &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/sysconfig/kubelet&lt;/code&gt; with the following content:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;KUBELET_EXTRA_ARGS&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;--cgroup-driver&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;systemd &lt;span class=&quot;nt&quot;&gt;--fail-swap-on&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;false&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Start and enable crio and kubelet services:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;systemctl daemon-reload
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;systemctl &lt;span class=&quot;nb&quot;&gt;enable&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;--now&lt;/span&gt; crio
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;systemctl &lt;span class=&quot;nb&quot;&gt;enable&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;--now&lt;/span&gt; kubelet
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I stopped and disabled firewalld service in order to quite the local firewall.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;systemctl disable &lt;span class=&quot;nt&quot;&gt;--now&lt;/span&gt; firewalld
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Nevertheless, disabling the local firewall is not an option in many cases. Therefore, following ports should be opened on the firewall if you do not want to quite the local firewall.&lt;/p&gt;

&lt;p&gt;on master node:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;firewall-cmd &lt;span class=&quot;nt&quot;&gt;--add-port&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;={&lt;/span&gt;6443,2379-2380,10250,10251,10252,5473,179,5473&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;/tcp &lt;span class=&quot;nt&quot;&gt;--permanent&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;firewall-cmd &lt;span class=&quot;nt&quot;&gt;--add-port&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;={&lt;/span&gt;4789,8285,8472&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;/udp &lt;span class=&quot;nt&quot;&gt;--permanent&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;firewall-cmd &lt;span class=&quot;nt&quot;&gt;--reload&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;on worker nodes:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;firewall-cmd &lt;span class=&quot;nt&quot;&gt;--add-port&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;={&lt;/span&gt;10250,30000-32767,5473,179,5473&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;/tcp &lt;span class=&quot;nt&quot;&gt;--permanent&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;firewall-cmd &lt;span class=&quot;nt&quot;&gt;--add-port&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;={&lt;/span&gt;4789,8285,8472&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;/udp &lt;span class=&quot;nt&quot;&gt;--permanent&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;firewall-cmd &lt;span class=&quot;nt&quot;&gt;--reload&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;initialize-master-control-node&quot;&gt;Initialize master (control) node:&lt;/h2&gt;

&lt;p&gt;Initialize an application subnet for the cluster&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;kubeadm init &lt;span class=&quot;nt&quot;&gt;--pod-network-cidr&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;10.85.0.0/16 
.........
.........
Your Kubernetes control-plane has initialized successfully!

To start using your cluster, you need to run the following as a regular user:

  &lt;span class=&quot;nb&quot;&gt;mkdir&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$HOME&lt;/span&gt;/.kube
  &lt;span class=&quot;nb&quot;&gt;sudo cp&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; /etc/kubernetes/admin.conf &lt;span class=&quot;nv&quot;&gt;$HOME&lt;/span&gt;/.kube/config
  &lt;span class=&quot;nb&quot;&gt;sudo chown&lt;/span&gt; &lt;span class=&quot;si&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;id&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-u&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;)&lt;/span&gt;:&lt;span class=&quot;si&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;id&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-g&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$HOME&lt;/span&gt;/.kube/config

Alternatively, &lt;span class=&quot;k&quot;&gt;if &lt;/span&gt;you are the root user, you can run:

  &lt;span class=&quot;nb&quot;&gt;export &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;KUBECONFIG&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/etc/kubernetes/admin.conf

You should now deploy a pod network to the cluster.
Run &lt;span class=&quot;s2&quot;&gt;&quot;kubectl apply -f [podnetwork].yaml&quot;&lt;/span&gt; with one of the options listed at:
  https://kubernetes.io/docs/concepts/cluster-administration/addons/

Then you can &lt;span class=&quot;nb&quot;&gt;join &lt;/span&gt;any number of worker nodes by running the following on each as root:

kubeadm &lt;span class=&quot;nb&quot;&gt;join &lt;/span&gt;192.168.11.71:6443 &lt;span class=&quot;nt&quot;&gt;--token&lt;/span&gt; 44ph3l.4g2dyf2w1zlhsfea &lt;span class=&quot;nt&quot;&gt;--discovery-token-ca-cert-hash&lt;/span&gt; sha256:44cbeb23b7d600e02c42690c6de03d5aa3cbad3dfec356fbb9afcb7c89e30574
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Run suggested steps:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;mkdir&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$HOME&lt;/span&gt;/.kube
&lt;span class=&quot;nb&quot;&gt;sudo cp&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; /etc/kubernetes/admin.conf &lt;span class=&quot;nv&quot;&gt;$HOME&lt;/span&gt;/.kube/config
&lt;span class=&quot;nb&quot;&gt;sudo chown&lt;/span&gt; &lt;span class=&quot;si&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;id&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-u&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;)&lt;/span&gt;:&lt;span class=&quot;si&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;id&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-g&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$HOME&lt;/span&gt;/.kube/config
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Check results on the master node:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;admin@kube-master1 ~]&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;kubectl get nodes
NAME                        STATUS   ROLES                  AGE    VERSION
kube-master1.ocp.home.lab   Ready    control-plane,master   14m    v1.23.5
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;admin@kube-master1 ~]&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;kubectl describe node kube-master1.ocp.home.lab | &lt;span class=&quot;nb&quot;&gt;grep &lt;/span&gt;NoSchedule
Taints:             node-role.kubernetes.io/master:NoSchedule
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;admin@kube-master1 ~]&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;kubectl taint nodes &lt;span class=&quot;nt&quot;&gt;--all&lt;/span&gt; node-role.kubernetes.io/master-
node/kube-master1.ocp.home.lab untainted
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;admin@kube-master1 ~]&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;kubectl describe node kube-master1.ocp.home.lab | &lt;span class=&quot;nb&quot;&gt;grep &lt;/span&gt;NoSchedule
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;initialize-worker-nodes&quot;&gt;Initialize worker nodes&lt;/h2&gt;

&lt;p&gt;Run suggested steps from control plane initialization from the previous step.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;kubeadm &lt;span class=&quot;nb&quot;&gt;join &lt;/span&gt;192.168.11.71:6443 &lt;span class=&quot;nt&quot;&gt;--token&lt;/span&gt; 44ph3l.4g2dyf2w1zlhsfea &lt;span class=&quot;nt&quot;&gt;--discovery-token-ca-cert-hash&lt;/span&gt; sha256:44cbeb23b7d600e02c42690c6de03d5aa3cbad3dfec356fbb9afcb7c89e30574
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And check result on the control node:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;admin@kube-master1 files]&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;kubectl get nodes
NAME                        STATUS   ROLES                  AGE     VERSION
kube-master1.ocp.home.lab   Ready    control-plane,master   3m32s   v1.23.5
kube-worker2.ocp.home.lab   Ready    &amp;lt;none&amp;gt;                 13s     v1.23.5

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;initialize-cluster-network&quot;&gt;Initialize cluster network.&lt;/h2&gt;

&lt;p&gt;I order to manage communication between clusters we need to install network operator. For these purpose I applied &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;kube-flannel&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Download &lt;a href=&quot;https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml&quot;&gt;kube-flannel.yml&lt;/a&gt; and edit it. Change &lt;em&gt;network&lt;/em&gt; and &lt;em&gt;type&lt;/em&gt; fields:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;.....
  net-conf.json: |
    &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;s2&quot;&gt;&quot;Network&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;10.85.0.0/16&quot;&lt;/span&gt;,
      &lt;span class=&quot;s2&quot;&gt;&quot;Backend&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;s2&quot;&gt;&quot;Type&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;host-gw&quot;&lt;/span&gt;
      &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
.....
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And apply the file. This will install flannel.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;kubectl apply &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; kube-flannel.yaml
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And check, if pod has been started:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;admin@kube-master1 files]&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;kubectl get pods &lt;span class=&quot;nt&quot;&gt;-n&lt;/span&gt; kube-system
....
kube-flannel-ds-slmth                               1/1     Running   0             56s
......
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Network i configured.&lt;/p&gt;

&lt;p&gt;Let’s check node info:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;admin@kube-master1 ~]&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;kubectl get node kube-master1.ocp.home.lab &lt;span class=&quot;nt&quot;&gt;-o&lt;/span&gt; json | jq &lt;span class=&quot;nt&quot;&gt;-r&lt;/span&gt; .status.nodeInfo
&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;s2&quot;&gt;&quot;architecture&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;amd64&quot;&lt;/span&gt;,
  &lt;span class=&quot;s2&quot;&gt;&quot;bootID&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;f2e99e5f-fb80-4a43-874c-c453a7718acc&quot;&lt;/span&gt;,
  &lt;span class=&quot;s2&quot;&gt;&quot;containerRuntimeVersion&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;cri-o://1.22.3&quot;&lt;/span&gt;,
  &lt;span class=&quot;s2&quot;&gt;&quot;kernelVersion&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;5.16.18-200.fc35.x86_64&quot;&lt;/span&gt;,
  &lt;span class=&quot;s2&quot;&gt;&quot;kubeProxyVersion&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;v1.23.5&quot;&lt;/span&gt;,
  &lt;span class=&quot;s2&quot;&gt;&quot;kubeletVersion&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;v1.23.5&quot;&lt;/span&gt;,
  &lt;span class=&quot;s2&quot;&gt;&quot;machineID&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;e155c9da8fb44c0d9d39f78b8091257f&quot;&lt;/span&gt;,
  &lt;span class=&quot;s2&quot;&gt;&quot;operatingSystem&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;linux&quot;&lt;/span&gt;,
  &lt;span class=&quot;s2&quot;&gt;&quot;osImage&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;Fedora Linux 35 (Server Edition)&quot;&lt;/span&gt;,
  &lt;span class=&quot;s2&quot;&gt;&quot;systemUUID&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;95f225e2-3e81-4282-9a95-f3eee6ee12ac&quot;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;This post is not finished.&lt;/strong&gt;&lt;/p&gt;

&lt;h2 id=&quot;references&quot;&gt;References&lt;/h2&gt;</content><author><name>{&quot;name&quot;=&gt;nil, &quot;avatar&quot;=&gt;nil, &quot;bio&quot;=&gt;&quot;&quot;, &quot;location&quot;=&gt;nil, &quot;email&quot;=&gt;nil}</name></author><category term="kubernetes" /><summary type="html"></summary></entry></feed>